{"remainingRequest":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_vue-loader@15.9.6@vue-loader/lib/index.js??vue-loader-options!/Users/navyxu/PycharmProjects/ox/frontend/src/views/LoginView.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/navyxu/PycharmProjects/ox/frontend/src/views/LoginView.vue","mtime":1619105869769},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_vue-loader@15.9.6@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHBvc3RBdXRoTG9naW4gfSBmcm9tICdAL2FwaS9sb2dpbkFwaSc7CmltcG9ydCBzdG9yYWdlIGZyb20gJy4uL3V0aWxzJzsKCmV4cG9ydCBkZWZhdWx0IHsKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZm9ybTogewogICAgICAgICAgICAgICAgdXNlcm5hbWU6ICcnLAogICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICcnLAogICAgICAgICAgICB9LAogICAgICAgICAgICBlcnJvcnM6IHt9LAogICAgICAgICAgICBmb3JtUHJvY2Vzc2luZzogZmFsc2UsCiAgICAgICAgfTsKICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgbG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7IHVzZXJuYW1lLCBwYXNzd29yZCB9OwogICAgICAgICAgICByZXR1cm4gcG9zdEF1dGhMb2dpbihkYXRhKTsKICAgICAgICB9LAoKICAgICAgICBhc3luYyBvblN1Ym1pdChldmVudCkgewogICAgICAgICAgICB0aGlzLmZvcm1Qcm9jZXNzaW5nID0gdHJ1ZTsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGxvZ2luUmVzID0gYXdhaXQgdGhpcy5sb2dpbih0aGlzLmZvcm0udXNlcm5hbWUsIHRoaXMuZm9ybS5wYXNzd29yZCk7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBsb2dpblJlcy5kYXRhOwoKICAgICAgICAgICAgICAgIGNvbnN0IGF1dGhUb2tlbiA9IHJlc3VsdFsnYXV0aF90b2tlbiddOwogICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfQVVUSF9UT0tFTicsIGF1dGhUb2tlbik7CiAgICAgICAgICAgICAgICBzdG9yYWdlLnNhdmVBdXRoVG9rZW4oYXV0aFRva2VuKTsKCiAgICAgICAgICAgICAgICBjb25zdCB1c2VyRGF0YSA9IHJlc3VsdC51c2VyOwogICAgICAgICAgICAgICAgY29uc3QgdXNlciA9IHsKICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJEYXRhLmlkLAogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VyRGF0YS51c2VybmFtZSwKICAgICAgICAgICAgICAgICAgICBuaWNrbmFtZTogdXNlckRhdGEubmlja25hbWUsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfVVNFUicsIHVzZXIpOwogICAgICAgICAgICAgICAgc3RvcmFnZS5zYXZlVXNlcih1c2VyKTsKCiAgICAgICAgICAgICAgICB0aGlzLmZvcm1Qcm9jZXNzaW5nID0gZmFsc2U7CgogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAncm9ib3QtbGlzdCcgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID49IDUwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRidlRvYXN0LnRvYXN0KCfmnI3liqHnq6/plJnor68nLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+eZu+W9leWksei0pScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvSGlkZURlbGF5OiAzMDAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RlcjogJ2ItdG9hc3Rlci10b3AtY2VudGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ6ICdkYW5nZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kVG9hc3Q6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnJlc3BvbnNlLnN0YXR1cyA+PSA0MDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZm9ybSB2YWxpZGF0aW9uIGVycm9yCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzID0gZXJyb3IucmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ2VG9hc3QudG9hc3QoZXJyb3IubWVzc2FnZSwgewogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+eZu+W9leWksei0pScsCiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9IaWRlRGVsYXk6IDMwMDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ZXI6ICdiLXRvYXN0ZXItdG9wLWNlbnRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ6ICdkYW5nZXInLAogICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRUb2FzdDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1JFTU9WRV9BVVRIX1RPS0VOJyk7CiAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1JFTU9WRV9VU0VSJyk7CiAgICAgICAgICAgICAgICBzdG9yYWdlLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB0aGlzLmZvcm1Qcm9jZXNzaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgfSwKfTsK"},{"version":3,"sources":["LoginView.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LoginView.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <div class=\"fixed-top fixed-bottom login-page\">\n        <b-row>\n            <b-col sm=\"12\" md=\"6\" lg=\"4\" offset-md=\"3\" offset-lg=\"4\">\n                <b-card class=\"p-lg-3\">\n                    <div class=\"title py-4 text-secondary\">\n                        <b-icon icon=\"x-diamond\" scale=\"3\" class=\"mr-4\" />\n                        <h4>公牛比特量化</h4>\n                    </div>\n                    <div class=\"text-center small text-secondary py-4 mb-2\">使用账号密码登录</div>\n                    <b-form @submit=\"onSubmit\">\n                        <b-alert :show=\"errors && Object.keys(errors).length > 0\" variant=\"danger\">\n                            {{ errors['non_field_errors'] && errors['non_field_errors'][0] }}\n                        </b-alert>\n                        <b-form-group>\n                            <b-input-group class=\"input-group\" size=\"lg\">\n                                <b-input-group-prepend class=\"prepend-class\">\n                                    <b-icon icon=\"person-fill\"></b-icon>\n                                </b-input-group-prepend>\n                                <b-form-input\n                                    class=\"input-class\"\n                                    v-model=\"form.username\"\n                                    type=\"text\"\n                                    placeholder=\"\"\n                                    required\n                                />\n                            </b-input-group>\n                        </b-form-group>\n                        <b-form-group>\n                            <b-input-group class=\"input-group\" size=\"lg\">\n                                <b-input-group-prepend class=\"prepend-class\">\n                                    <b-icon icon=\"key-fill\"></b-icon>\n                                </b-input-group-prepend>\n                                <b-input\n                                    class=\"input-class\"\n                                    placeholder=\"密码\"\n                                    v-model=\"form.password\"\n                                    type=\"password\"\n                                    required\n                                />\n                            </b-input-group>\n                        </b-form-group>\n                        <b-button\n                            size=\"lg\"\n                            class=\"mt-5 mb-4\"\n                            type=\"submit\"\n                            block\n                            variant=\"primary\"\n                            :disabled=\"formProcessing\"\n                            >登录</b-button\n                        >\n                    </b-form>\n                </b-card>\n            </b-col>\n        </b-row>\n    </div>\n</template>\n\n<script>\nimport { postAuthLogin } from '@/api/loginApi';\nimport storage from '../utils';\n\nexport default {\n    data() {\n        return {\n            form: {\n                username: '',\n                password: '',\n            },\n            errors: {},\n            formProcessing: false,\n        };\n    },\n    methods: {\n        login(username, password) {\n            const data = { username, password };\n            return postAuthLogin(data);\n        },\n\n        async onSubmit(event) {\n            this.formProcessing = true;\n            event.preventDefault();\n            try {\n                const loginRes = await this.login(this.form.username, this.form.password);\n                const result = loginRes.data;\n\n                const authToken = result['auth_token'];\n                this.$store.commit('SET_AUTH_TOKEN', authToken);\n                storage.saveAuthToken(authToken);\n\n                const userData = result.user;\n                const user = {\n                    userId: userData.id,\n                    username: userData.username,\n                    nickname: userData.nickname,\n                };\n                this.$store.commit('SET_USER', user);\n                storage.saveUser(user);\n\n                this.formProcessing = false;\n\n                await this.$router.push({ name: 'robot-list' });\n            } catch (error) {\n                if (error.response) {\n                    if (error.response.status >= 500) {\n                        this.$bvToast.toast('服务端错误', {\n                            title: '登录失败',\n                            autoHideDelay: 3000,\n                            toaster: 'b-toaster-top-center',\n                            variant: 'danger',\n                            appendToast: false,\n                        });\n                    } else if (error.response.status >= 400) {\n                        // form validation error\n                        this.errors = error.response.data;\n                    }\n                } else {\n                    this.$bvToast.toast(error.message, {\n                        title: '登录失败',\n                        autoHideDelay: 3000,\n                        toaster: 'b-toaster-top-center',\n                        variant: 'danger',\n                        appendToast: false,\n                    });\n                }\n                this.$store.commit('REMOVE_AUTH_TOKEN');\n                this.$store.commit('REMOVE_USER');\n                storage.clear();\n                this.formProcessing = false;\n            }\n        },\n    },\n};\n</script>\n\n<style scoped lang=\"scss\">\n.login-page {\n    background: linear-gradient(150deg, #98aaff 0%, #0270e6 100%);\n    // background: linear-gradient(180deg, #4e73df 10%, #224abe 100%);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    .row {\n        width: 100%;\n    }\n}\n.title {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-bottom: 1px solid #eee;\n}\n.form-group {\n    margin-bottom: 2rem;\n}\n.card-body {\n    padding: 36px;\n}\n.input-group {\n    // box-shadow: 0 2px 12px rgba($color: #000000, $alpha: 0.1);\n    box-shadow: 0 1px 3px rgba(50, 50, 93, 0.15), 0 1px 0 rgba(0, 0, 0, 0.02);\n    color: #adb5bd;\n    .prepend-class {\n        width: 46px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n    }\n    .input-class {\n        border: none;\n        font-size: 1rem;\n        line-height: 1.5;\n        color: $secondary;\n    }\n}\n</style>\n"]}]}