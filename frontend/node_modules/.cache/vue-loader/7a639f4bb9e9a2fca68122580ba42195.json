{"remainingRequest":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_vue-loader@15.9.6@vue-loader/lib/index.js??vue-loader-options!/Users/navyxu/PycharmProjects/ox/frontend/src/views/LoginView.vue?vue&type=style&index=0&id=741d5842&scoped=true&lang=scss&","dependencies":[{"path":"/Users/navyxu/PycharmProjects/ox/frontend/src/views/LoginView.vue","mtime":1619105869769},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_vue-loader@15.9.6@vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_sass-loader@8.0.2@sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_vue-loader@15.9.6@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5sb2dpbi1wYWdlIHsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNTBkZWcsICM5OGFhZmYgMCUsICMwMjcwZTYgMTAwJSk7CiAgICAvLyBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCAjNGU3M2RmIDEwJSwgIzIyNGFiZSAxMDAlKTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAucm93IHsKICAgICAgICB3aWR0aDogMTAwJTsKICAgIH0KfQoudGl0bGUgewogICAgZGlzcGxheTogZmxleDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZWVlOwp9Ci5mb3JtLWdyb3VwIHsKICAgIG1hcmdpbi1ib3R0b206IDJyZW07Cn0KLmNhcmQtYm9keSB7CiAgICBwYWRkaW5nOiAzNnB4Owp9Ci5pbnB1dC1ncm91cCB7CiAgICAvLyBib3gtc2hhZG93OiAwIDJweCAxMnB4IHJnYmEoJGNvbG9yOiAjMDAwMDAwLCAkYWxwaGE6IDAuMSk7CiAgICBib3gtc2hhZG93OiAwIDFweCAzcHggcmdiYSg1MCwgNTAsIDkzLCAwLjE1KSwgMCAxcHggMCByZ2JhKDAsIDAsIDAsIDAuMDIpOwogICAgY29sb3I6ICNhZGI1YmQ7CiAgICAucHJlcGVuZC1jbGFzcyB7CiAgICAgICAgd2lkdGg6IDQ2cHg7CiAgICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIH0KICAgIC5pbnB1dC1jbGFzcyB7CiAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgIGZvbnQtc2l6ZTogMXJlbTsKICAgICAgICBsaW5lLWhlaWdodDogMS41OwogICAgICAgIGNvbG9yOiAkc2Vjb25kYXJ5OwogICAgfQp9Cg=="},{"version":3,"sources":["LoginView.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LoginView.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <div class=\"fixed-top fixed-bottom login-page\">\n        <b-row>\n            <b-col sm=\"12\" md=\"6\" lg=\"4\" offset-md=\"3\" offset-lg=\"4\">\n                <b-card class=\"p-lg-3\">\n                    <div class=\"title py-4 text-secondary\">\n                        <b-icon icon=\"x-diamond\" scale=\"3\" class=\"mr-4\" />\n                        <h4>公牛比特量化</h4>\n                    </div>\n                    <div class=\"text-center small text-secondary py-4 mb-2\">使用账号密码登录</div>\n                    <b-form @submit=\"onSubmit\">\n                        <b-alert :show=\"errors && Object.keys(errors).length > 0\" variant=\"danger\">\n                            {{ errors['non_field_errors'] && errors['non_field_errors'][0] }}\n                        </b-alert>\n                        <b-form-group>\n                            <b-input-group class=\"input-group\" size=\"lg\">\n                                <b-input-group-prepend class=\"prepend-class\">\n                                    <b-icon icon=\"person-fill\"></b-icon>\n                                </b-input-group-prepend>\n                                <b-form-input\n                                    class=\"input-class\"\n                                    v-model=\"form.username\"\n                                    type=\"text\"\n                                    placeholder=\"\"\n                                    required\n                                />\n                            </b-input-group>\n                        </b-form-group>\n                        <b-form-group>\n                            <b-input-group class=\"input-group\" size=\"lg\">\n                                <b-input-group-prepend class=\"prepend-class\">\n                                    <b-icon icon=\"key-fill\"></b-icon>\n                                </b-input-group-prepend>\n                                <b-input\n                                    class=\"input-class\"\n                                    placeholder=\"密码\"\n                                    v-model=\"form.password\"\n                                    type=\"password\"\n                                    required\n                                />\n                            </b-input-group>\n                        </b-form-group>\n                        <b-button\n                            size=\"lg\"\n                            class=\"mt-5 mb-4\"\n                            type=\"submit\"\n                            block\n                            variant=\"primary\"\n                            :disabled=\"formProcessing\"\n                            >登录</b-button\n                        >\n                    </b-form>\n                </b-card>\n            </b-col>\n        </b-row>\n    </div>\n</template>\n\n<script>\nimport { postAuthLogin } from '@/api/loginApi';\nimport storage from '../utils';\n\nexport default {\n    data() {\n        return {\n            form: {\n                username: '',\n                password: '',\n            },\n            errors: {},\n            formProcessing: false,\n        };\n    },\n    methods: {\n        login(username, password) {\n            const data = { username, password };\n            return postAuthLogin(data);\n        },\n\n        async onSubmit(event) {\n            this.formProcessing = true;\n            event.preventDefault();\n            try {\n                const loginRes = await this.login(this.form.username, this.form.password);\n                const result = loginRes.data;\n\n                const authToken = result['auth_token'];\n                this.$store.commit('SET_AUTH_TOKEN', authToken);\n                storage.saveAuthToken(authToken);\n\n                const userData = result.user;\n                const user = {\n                    userId: userData.id,\n                    username: userData.username,\n                    nickname: userData.nickname,\n                };\n                this.$store.commit('SET_USER', user);\n                storage.saveUser(user);\n\n                this.formProcessing = false;\n\n                await this.$router.push({ name: 'robot-list' });\n            } catch (error) {\n                if (error.response) {\n                    if (error.response.status >= 500) {\n                        this.$bvToast.toast('服务端错误', {\n                            title: '登录失败',\n                            autoHideDelay: 3000,\n                            toaster: 'b-toaster-top-center',\n                            variant: 'danger',\n                            appendToast: false,\n                        });\n                    } else if (error.response.status >= 400) {\n                        // form validation error\n                        this.errors = error.response.data;\n                    }\n                } else {\n                    this.$bvToast.toast(error.message, {\n                        title: '登录失败',\n                        autoHideDelay: 3000,\n                        toaster: 'b-toaster-top-center',\n                        variant: 'danger',\n                        appendToast: false,\n                    });\n                }\n                this.$store.commit('REMOVE_AUTH_TOKEN');\n                this.$store.commit('REMOVE_USER');\n                storage.clear();\n                this.formProcessing = false;\n            }\n        },\n    },\n};\n</script>\n\n<style scoped lang=\"scss\">\n.login-page {\n    background: linear-gradient(150deg, #98aaff 0%, #0270e6 100%);\n    // background: linear-gradient(180deg, #4e73df 10%, #224abe 100%);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    .row {\n        width: 100%;\n    }\n}\n.title {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-bottom: 1px solid #eee;\n}\n.form-group {\n    margin-bottom: 2rem;\n}\n.card-body {\n    padding: 36px;\n}\n.input-group {\n    // box-shadow: 0 2px 12px rgba($color: #000000, $alpha: 0.1);\n    box-shadow: 0 1px 3px rgba(50, 50, 93, 0.15), 0 1px 0 rgba(0, 0, 0, 0.02);\n    color: #adb5bd;\n    .prepend-class {\n        width: 46px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n    }\n    .input-class {\n        border: none;\n        font-size: 1rem;\n        line-height: 1.5;\n        color: $secondary;\n    }\n}\n</style>\n"]}]}