{"remainingRequest":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_vue-loader@15.9.6@vue-loader/lib/index.js??vue-loader-options!/Users/navyxu/PycharmProjects/ox/frontend/src/views/RobotListView.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/navyxu/PycharmProjects/ox/frontend/src/views/RobotListView.vue","mtime":1619057276519},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/navyxu/PycharmProjects/ox/frontend/node_modules/_vue-loader@15.9.6@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBSb2JvdExpc3RJdGVtIGZyb20gJy4uL2NvbXBvbmVudHMvUm9ib3RMaXN0SXRlbSc7CmltcG9ydCB7Z2V0Um9ib3RzfSBmcm9tICdAL2FwaSc7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ3JvYm90LWxpc3QnLAogIGNvbXBvbmVudHM6IHsKICAgIFJvYm90TGlzdEl0ZW0sCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcm9ib3RMaXN0OiBbXSwKICAgICAgdGltZXI6ICcnLCAvLyDlrprml7blmahpZAogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHJlZnJlc2hMaXN0KCkgewogICAgICB0aGlzLmdldFJvYm90TGlzdCgpOwogICAgfSwKICAgIHNldFJvYm90TGlzdChkYXRhKSB7CiAgICAgIHRoaXMucm9ib3RMaXN0ID0gZGF0YS5tYXAocm9ib3QgPT4gKHsKICAgICAgICByb2JvdElkOiByb2JvdC5pZCwKICAgICAgICBuYW1lOiByb2JvdC5uYW1lLAogICAgICAgIHBhaXI6IHJvYm90LnBhaXIsCiAgICAgICAgdGFyZ2V0Q3VycmVuY3k6IHJvYm90LnRhcmdldF9jdXJyZW5jeSwKICAgICAgICBlbmFibGVkOiByb2JvdC5lbmFibGVkLAogICAgICAgIHN0YXJ0VGltZTogcm9ib3RbJ3N0YXJ0X3RpbWUnXSwKICAgICAgICBwaW5nVGltZTogcm9ib3RbJ3BpbmdfdGltZSddLAogICAgICAgIGNyZWF0ZWRBdDogcm9ib3RbJ2NyZWF0ZWRfYXQnXSwKICAgICAgICBkdXJhdGlvbkRpc3BsYXk6IHJvYm90WydkdXJhdGlvbl9kaXNwbGF5J10sCiAgICAgICAgc3RyYXRlZ3lOYW1lOiByb2JvdFsnc3RyYXRlZ3lfbmFtZSddLAogICAgICAgIGV4Y2hhbmdlTmFtZVpoOiByb2JvdFsnZXhjaGFuZ2UnXVsnbmFtZV96aCddLAogICAgICAgIGV4Y2hhbmdlTmFtZTogcm9ib3QuZXhjaGFuZ2UubmFtZSwKICAgICAgICBwcm9maXRSYXRpb1B0Zzogcm9ib3RbJ2Fzc2V0X3JlY29yZCddWyd0b3RhbF9wbmxfcmVsX3B0ZyddLAogICAgICAgIHByb2ZpdFJhdGlvUHRnMjRoOiByb2JvdFsnYXNzZXRfcmVjb3JkJ11bJ3RvdGFsX3BubF9yZWxfcHRnXzI0aCddLAogICAgICAgIHByb2ZpdDI0aDogcm9ib3RbJ2Fzc2V0X3JlY29yZCddWyd0b3RhbF9wbmxfYWJzXzI0aCddLAogICAgICAgIHByb2ZpdDogcm9ib3RbJ2Fzc2V0X3JlY29yZCddWyd0b3RhbF9wbmxfYWJzJ10sCiAgICAgICAgcHJpbmNpcGFsOiByb2JvdFsnYXNzZXRfcmVjb3JkJ11bJ3RvdGFsX3ByaW5jaXBhbCddLAogICAgICAgIGJhbGFuY2U6IHJvYm90Wydhc3NldF9yZWNvcmQnXVsndG90YWxfYmFsYW5jZSddLAogICAgICB9KSk7CiAgICB9LAogICAgYXN5bmMgZ2V0Um9ib3RMaXN0KCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJvYm90c1JlcyA9IGF3YWl0IGdldFJvYm90cygpOwogICAgICAgIHRoaXMuc2V0Um9ib3RMaXN0KHJvYm90c1Jlcy5kYXRhKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UpIHsKICAgICAgICAgIHRoaXMuJGJ2VG9hc3QudG9hc3QoJ+aXoOazleiOt+WPluacuuWZqOS6uuWIl+ihqOaVsOaNricsIHsKICAgICAgICAgICAgdGl0bGU6ICfml6Dms5Xojrflj5bmnLrlmajkurrliJfooajmlbDmja4nLAogICAgICAgICAgICBhdXRvSGlkZURlbGF5OiAzMDAwLAogICAgICAgICAgICB0b2FzdGVyOiAnYi10b2FzdGVyLXRvcC1jZW50ZXInLAogICAgICAgICAgICB2YXJpYW50OiAnZGFuZ2VyJywKICAgICAgICAgICAgYXBwZW5kVG9hc3Q6IGZhbHNlLAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJGJ2VG9hc3QudG9hc3QoZXJyb3IubWVzc2FnZSwgewogICAgICAgICAgICB0aXRsZTogJ+aXoOazleiOt+WPluacuuWZqOS6uuWIl+ihqOaVsOaNricsCiAgICAgICAgICAgIGF1dG9IaWRlRGVsYXk6IDMwMDAsCiAgICAgICAgICAgIHRvYXN0ZXI6ICdiLXRvYXN0ZXItdG9wLWNlbnRlcicsCiAgICAgICAgICAgIHZhcmlhbnQ6ICdkYW5nZXInLAogICAgICAgICAgICBhcHBlbmRUb2FzdDogZmFsc2UsCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVWaXNpYmlsaXR5Q2hhbmdlKCkgewogICAgICBjb25zdCBoaWRkZW4gPSBkb2N1bWVudC5oaWRkZW47CiAgICAgIGlmIChoaWRkZW4pIHsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXIpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnRpbWVyKSB7CiAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXIpOwogICAgICAgIH0KICAgICAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwodGhpcy5nZXRSb2JvdExpc3QsIDEwICogMTAwMCk7CiAgICAgIH0KICAgIH0sCiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5nZXRSb2JvdExpc3QoKTsKICAgIHRoaXMudGltZXIgPSBzZXRJbnRlcnZhbCh0aGlzLmdldFJvYm90TGlzdCwgMTAgKiAxMDAwKTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgdGhpcy5oYW5kbGVWaXNpYmlsaXR5Q2hhbmdlLCBmYWxzZSk7CiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTsKICB9LAp9Owo="},{"version":3,"sources":["RobotListView.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAmBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RobotListView.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"robot-list-view\">\n    <div class=\"ml-3 mb-3\">\n      <router-link :to=\"{name: 'robot-create'}\">\n        <b-button variant=\"primary\">\n          <b-icon icon=\"plus\" aria-hidden=\"true\"></b-icon>\n          创建机器人\n        </b-button>\n      </router-link>\n    </div>\n    <b-row>\n      <b-col lg=\"4\" md=\"6\" sm=\"12\" v-for=\"robot in robotList\" :key=\"robot.robotId\">\n        <robot-list-item :robot=\"robot\" @refresh=\"refreshList\"></robot-list-item>\n      </b-col>\n    </b-row>\n  </div>\n</template>\n\n<script>\nimport RobotListItem from '../components/RobotListItem';\nimport {getRobots} from '@/api';\n\nexport default {\n  name: 'robot-list',\n  components: {\n    RobotListItem,\n  },\n  data() {\n    return {\n      robotList: [],\n      timer: '', // 定时器id\n    };\n  },\n  methods: {\n    refreshList() {\n      this.getRobotList();\n    },\n    setRobotList(data) {\n      this.robotList = data.map(robot => ({\n        robotId: robot.id,\n        name: robot.name,\n        pair: robot.pair,\n        targetCurrency: robot.target_currency,\n        enabled: robot.enabled,\n        startTime: robot['start_time'],\n        pingTime: robot['ping_time'],\n        createdAt: robot['created_at'],\n        durationDisplay: robot['duration_display'],\n        strategyName: robot['strategy_name'],\n        exchangeNameZh: robot['exchange']['name_zh'],\n        exchangeName: robot.exchange.name,\n        profitRatioPtg: robot['asset_record']['total_pnl_rel_ptg'],\n        profitRatioPtg24h: robot['asset_record']['total_pnl_rel_ptg_24h'],\n        profit24h: robot['asset_record']['total_pnl_abs_24h'],\n        profit: robot['asset_record']['total_pnl_abs'],\n        principal: robot['asset_record']['total_principal'],\n        balance: robot['asset_record']['total_balance'],\n      }));\n    },\n    async getRobotList() {\n      try {\n        const robotsRes = await getRobots();\n        this.setRobotList(robotsRes.data);\n      } catch (error) {\n        if (error.response) {\n          this.$bvToast.toast('无法获取机器人列表数据', {\n            title: '无法获取机器人列表数据',\n            autoHideDelay: 3000,\n            toaster: 'b-toaster-top-center',\n            variant: 'danger',\n            appendToast: false,\n          });\n        } else {\n          this.$bvToast.toast(error.message, {\n            title: '无法获取机器人列表数据',\n            autoHideDelay: 3000,\n            toaster: 'b-toaster-top-center',\n            variant: 'danger',\n            appendToast: false,\n          });\n        }\n      }\n    },\n    handleVisibilityChange() {\n      const hidden = document.hidden;\n      if (hidden) {\n        clearInterval(this.timer);\n      } else {\n        if (this.timer) {\n          clearInterval(this.timer);\n        }\n        this.timer = setInterval(this.getRobotList, 10 * 1000);\n      }\n    },\n  },\n  mounted() {\n    this.getRobotList();\n    this.timer = setInterval(this.getRobotList, 10 * 1000);\n    window.addEventListener('visibilitychange', this.handleVisibilityChange, false);\n  },\n  beforeDestroy() {\n    clearInterval(this.timer);\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\n.robot-list-view {\n  width: 100%;\n\n  .row {\n    margin: 0;\n  }\n}\n</style>\n"]}]}